\chapter{Hardware Implementation}
\label{chap:Field}

In previous chapters (chapter \ref{chap:IS}, chapter \ref{chap:US} and chapter \ref{chap:HS}), the focus has been on characterizing the performance of the CR systems jointly in terms of interference power received by the primary receiver and throughput at the secondary receiver by taking the estimation of the involved channels into account. In addition, it is motivated that the low complexity and the versatility towards unknown primary user signals requirements can be satisfied by employing unconventional channel estimation techniques such as received power-based estimation for acquiring the knowledge of the interacting channels, particularly the channels between the primary and the secondary systems. However, the aforementioned analysis in the previous chapters has been limited to the theoretical expressions. This chapter further extends the performance analysis by deploying the proposed channel estimation techniques on a hardware. In this sense, this chapters examines the feasibility of the assumptions considered while deriving the analytical expressions, thereby facilitating the evolution of the proposed framework. With no loss of generality, an underlay system is considered for the deployment.    
%\begin{abstract}        % give a summary of your paper
%Cognitive radio is one of the potential contenders that address the problem of spectrum scarcity by making efficient use of the currently allocated spectrum below \SI{6}{GHz}. A secondary access to the licensed spectrum is only possible, if the cognitive radio systems restrict the interference to the primary systems. However, the performance analysis of such a cognitive radio system is a challenging task. Currently, performance evaluation of underlay systems is limited to theoretical analysis. Most of the existing theoretical investigations make certain assumptions in order to sustain analytical tractability, which could be unrealistic from the deployment perspective. Motivated by this fact, in this work, we validate the performance of an underlay system by means of laboratory measurements, and consequently propose a hardware demonstrator of such a system. Moreover, we present a graphical user interface to provide insights to the working of the proposed demonstrator and highlight the main issues faced during this experimental study.
%\blfootnote{This work was partially supported by the National Research Fund, Luxembourg under the CORE projects "SeMIGod" and "SATSENT".} 

% please supply keywords within your abstract
%\keywords {Cognitive Relay, underlay system, power control, dynamic access, empirical validation, demonstrator}
%\end{abstract}



%\section{Related Work}

%The amount of data transmitted over wireless channels is constantly increasing. However, the available spectrum is scarce and expensive, with more and more operators competing for their share of it. Therefore, ways have to be found to use the available spectrum more efficiently. Cognitive radio networks do so by enabling dynamic spectrum access to multiple systems. Secondary access to the licensed spectrum has been extensively investigated in the literature and is mainly categorized in terms of three cognitive radio paradigms \cite{Goldsmith09}: 
%\begin{enumerate}
%	\item An interweave system exploits time gaps in the spectrum of primary users for data transmission. 
%	\item An overlay system involves higher network layers to employ advanced coding algorithms to transmit data simultaneously with other systems. 
%	\item In an underlay system, spectrum access is enabled only if the interference power received at primary users is below a certain amount. This can be achieved, for instance, by employing a power control mechanism at the secondary transmitter. 
%\end{enumerate}

%The existing investigations in \cite{Ghasemi07, Xin09, Musa09} depicted the performance limits in terms of throughput achieved at the secondary receiver for the underlay system. However, the performance evaluation has been limited to theoretical analysis, which tends to make certain assumptions (for instance, perfect knowledge of channel), that are not applicable in hardware implementations \cite{Sharma15}. Recently, hardware implementations in context to cognitive radio systems have started to receive significant attention \cite{Ngu13, Anas12, Combes15}, however these deployments are mainly concerned with the interweave system. In this regard, we provide insights for the deployment of underlay systems, in this paper. More specifically, we extend the mathematical framework derived in \cite{Kaushik15} to validate the performance of underlay systems by means of experimental analysis. To complement the analysis presented in \cite{Kaushik15}, 

This chapter provides the following contributions:
\begin{itemize}
	\item Empirical validation: The performance of the underlay systems subject to the employment of received power-based between the PR and the ST is validated by means of a hardware deployment. The variations (induced due to incorporation of channel estimation) in the system parameters are validated by comparing their probability density functions obtained from the measurements to the one computed analytically. Moreover, the joint performance of the underlay system is validate in terms of estimation-throughput tradeoff proposed in chapter \ref{chap:US}. %A suitable hardware environment is establish to perform measurements and evaluate their results by comparing them with the theoretical expressions.
	\item Demonstrator: Upon validating the theoretical expressions, a hardware demonstrator following the guidelines of an underlay system is deployed. Further insights to the working of the demonstrator are procured by means of a graphical user interface.	
\end{itemize}

%This paper is organized as follows: Section \ref{sysmod} introduces the system model. Section \ref{val} describes the experimental setup and the validation of the mathematical model. Section \ref{demo} portrays the implementation of the underlay system's hardware demonstrator. Finally, Section \ref{con} concludes the paper.


\section{System Model}
\label{sysmod}
In contrast to the framework presented in chapter \ref{chap:US}, following simplifications and modifications are considered for the hardware implementation.
\begin{itemize}
\item The channel estimation (received power-based) is deployed is only for the link between the PR and the ST, which is associated with the regulation of the interference (power) received at the PR. In order to simplify the deployment in terms of the elements involved, the interference from the PTs at the SR is neglected. In addition, perfect knowledge of the access channel between the ST and the SR that employs the pilot-based channel estimation is considered. 
\item The measurements of the validation and the demonstrator consider the deterministic behaviour of the interference channel.  
\item In contrast to the outage constraint proposed, a confidence probability constraint is employed for capturing the variations due to channel estimation. %Moreover, previous analysis considers the realization of the power control over multiple frame. Here, the power control subject  
\end{itemize}

Subject to aforementioned modifications, the system model for the underlay system is modified. 

\subsection{Underlay Scenario}
\label{scenario}
\figurename\ref{szenarioA} depicts a small cell deployment consisting of a CSC-BS, a MS, a PR and a MC-BS. Analog to the previous scenarios, CSC-BS and MS act as a ST. The channels between the primary receiver (PR) and ST and between the ST and SR are fading gains ($g_\textrm{p}, g_\textrm{s}$). A power control mechanism is employed at the ST to ensure that interference received at the PR is below a certain level. For this mechanism, it is necessary to acquire the knowledge of the channel between the ST and the PR. As proposed in \cite{Kaushik15}, the ST can retrieve this information by listening to a pilot or beacon signal transmitted by the PR. %For the received pilot signal ($y_\textrm{rcvd}$) and its power, we use the model and notations from \cite{Kaushik15}.

\subsection{Signal Model}

%ived signal at the ST, transmitted by the PR cf. \figurename~\ref{fig:scenario}, is sampled with a sampling frequency of $\fsam$ and is given by
\begin{equation}
\yrcvd[n] = \gpo \cdot \xtran[n] + \nas[n],
\label{eq:sys_mod_st}
\end{equation}
where $\xtran$ corresponds to a fixed discrete samples transmitted by the PR, $|\pgpo$ represents the power gain for the channel PR-ST and $\nas[n]$ is circularly symmetric complex Additive White Gaussian Noise (AWGN) at the ST.
The transmitted power at PR is $\ptran = \s{\tau \fsam}{|\xtran[n]|^2}$, considering that $\tau \fsam$ $(= N)$ is the number of samples used for estimation. $\nas[n]$ is an independent identically distributed (i.i.d.) Gaussian random process with zero mean and variance $\e{}{|\nas[n]|^2} = \nps$. The power received at the ST is given as
\begin{align}
\prcvd = \s{\tau \fsam}{ |\gpo \xtran[n] + \nas|^2}.
\label{eq:prcvd} 
\end{align}
Analog to (\ref{eq:sys_mod_st}), the received signal at the PR, transmitted by the ST, is given by
\begin{equation}
\yp[n] = \gpo \cdot \xreg[n] + \nap[n],
\label{eq:sys_mod_pr}
\end{equation}
and on the other side, the received signal at the SR follows
\begin{equation}
\ys[n] = \gs \cdot \xreg[n] + \nas[n],
\label{eq:sys_mod_sr}
\end{equation}
where $\xreg[n]$ is an i.i.d random process. 
\begin{align}
\preg = \s{(T - \tau) \fsam}{|\xreg[n]|^2} 
\label{eq:preg} 
\end{align}
corresponds to controlled power at the ST. Further, $\pgpo$ and $\pgs$ represent the power gains for channel ST-PR and ST-SR, cf. \figurename~\ref{fig:scenario}.
Considering (\ref{eq:sys_mod_pr}) and \ref{eq:sys_mod_sr}, the powers received at the PR and SR are evaluated as $\pp = \s{(T - \tau) \fsam}{|\yp[n]^2|}$ and $\ps = \s{(T - \tau) \fsam}{|\ys[n]^2|}$. Likewise (\ref{eq:sys_mod_st}), $\nap[n]$ and $\nas[n]$ represents circularly symmetric AWGN at PR and ST with zero mean and variance $\e{}{|\nap[n]|^2} = \npp$ and $\e{}{|\nas[n]|^2} = \nps$, correspondingly. %Consider that $\ptran$, $\preg$ and $\pp$ correspond to power for a given frame. 
%For (\ref{eq:sys_mod_sr}), we assume that the interference at SR from the PR via beacon or pilot channel is $< \nps$, which is a valid assumption considering the indoor scenario depicted in \figurename~\ref{fig:scenario}. 
%For (\ref{eq:sys_mod_sr}), we consider a perfect allignment of the ST to the beacon or pilot channe
%\subsubsection{Channel}

We consider that all transmitted signals are subjected to distance dependent path loss and small scale fading gains depicted as $\pgpo, \pgs$. In the analysis, the coherence time of the channels $\approx T$ is considered. But, there will be scenarios where the coherence time exceeds $T$, in such cases our characterization depicts a lower performance bound.


%\begin{figure}
	%\vspace{-10 pt}
%	\centering
%	\includegraphics[width=0.55\textwidth]{figures/CR_Scenario_Underlay}%
%	\includegraphics[width=0.45\textwidth]{figures/Frame}%
%	\caption{Underlay scenario and frame structure \cite{Kaushik15}}
%	\label{szenarioA}
	%\vspace{-10 pt}
%\end{figure}

We consider slotted medium access for the secondary system with a frame duration of $T$. For the ST to be able to satisfy the interference constraints at the PR, we consider channel reciprocity of the primary link. $T$ is designed such that the channel can be assumed to remain constant within it. Based on this premise, $g_\textrm{p}$ and $g_\textrm{s}$ are constant within one frame and included in $\alpha_\textrm{p}$ and $\alpha_\textrm{s}$ for further analysis.

In order to implement a power control mechanism, we have divided the frame interval in two phases, refer to Fig. \ref{szenarioA}. During the first phase of duration $\tau_\textrm{est}$ (estimation time), the ST measures the received power of the pilot signal transmitted by the PR. Based on this received power, the ST estimates $\alpha_\textrm{p}$ by relating it to the known PR transmit power ($P_\textrm{tran}$) and adapts its own transmit power for the secondary link ($P_\textrm{cont}$) accordingly. During the second phase duration i.e., $T-\tau_\textrm{est}$, the ST transmits data to the ID with the controlled power $P_\textrm{cont}$.

The sequence of events portrayed by the underlay scenario from Fig. \ref{szenarioA} can be summarized as:

\begin{enumerate}
	\item The PR sends a pilot signal with power $P_\textrm{tran}$ to the ST.
	\item The ST measures the power received ($P_\textrm{rcvd}$) from this signal.
	\item From $P_\textrm{rcvd}$, the ST estimates $\alpha_\textrm{p}$. We assume that the ST has the knowledge of  $P_\textrm{tran}$. 
	\item From $\alpha_\textrm{p}$, the ST calculates $P_\textrm{cont}$. It is scaled such that, in case of perfect channel reciprocity and the absence of noise on the primary link, the interference power arriving at the PR ($P_\textrm{p}$) has the value of the interference temperature ($\theta_\textrm{I}$). In control theory terms, $\theta_\textrm{I}$ is the setpoint for $P_\textrm{p}$.
	\item The ST transmits data to the SR with $P_\textrm{cont}$. In the context of this work, we send an unmodulated sinusoidal signal. This is mathematically equivalent to the constant power signal sent by the PR (refer to \cite{Kaushik15} and the references therein).
	\item The SR receives the data signal with power $P_\textrm{s}$. It provides this value back over a feedback channel to the ST, where it is used to estimate the expected throughput of the secondary link ($R_\textrm{s}$).
	\item Due to the presence of noise at the ST, the ST encounters variations in $P_\textrm{rcvd}$, which further affects $P_\textrm{cont}$ and, in addition with noise at the PR, finally translates to variations in $P_\textrm{p}$ around $\theta_\textrm{I}$. This may severely degrade the performance of the cognitive radio system. In order to control these variations, an interference constraint in terms of probability of confidence ($P_\textrm{c}$) has been proposed in \cite{Kaushik15}.
\end{enumerate}


\subsection{Stochastic Model}
\label{model}
According to \cite{Kaushik15}, $P_\textrm{rcvd}$ can be modeled as a non-central chi-squared distribution with the following probability density function (pdf) \cite{cha99}:
\begin{equation}
	\label{nxc2equ}
	f_{P_\textrm{rcvd}} \left(x\right) = 
	\frac{N}{2\sigma_\textrm{p}^2} \left(\frac{N x}{\lambda}\right)^\frac{N-2}{4}  
	\exp\left(-\frac{N x+\lambda}{2\sigma_\textrm{p}^2}\right)  I_{\frac{N}{2}-1}\left(\frac{\sqrt{N x\lambda}}{\sigma_\textrm{p}^2}\right) \;  ,
\end{equation}
where $N$ is the degree of freedom, i.e. the number of samples used for determining ${P_\textrm{rcvd}}$, $\sigma_\textrm{p}^2$ is the noise variance of the in-phase or quadrature-phase component of the received pilot signal ($y_\textrm{rcvd}$, refer to \cite{Kaushik15}), and $I_{\frac{N}{2}-1}(\cdot)$ is the modified Bessel function of the first kind of order $\frac{N}{2}-1$ \cite{Jef00}. Furthermore,
\begin{equation}
	\label{lambda}
	\lambda = \sum_{n=1}^N |\mathbb{E}\left[y_\textrm{rcvd}[n]\right]|^2 = N \times A^2
\end{equation}
is the non-centrality parameter, where $y_\textrm{rcvd}[n]$ represents the discrete sample at the ST \cite{Kaushik15}. As our pilot signal is a sinusoid with a constant amplitude which is down-converted by an IQ demodulator at the ST, the complex samples have a constant envelope of value $A$, which explains the simplification in (\ref{lambda}).

The system variables $P_\textrm{cont}$, $P_\textrm{p}$, and $R_\textrm{s}$ are derived from $P_\textrm{rcvd}$ in \cite{Kaushik15}, where the respective pdfs $f_{P_\textrm{cont}}(\cdot)$ and $f_{P_\textrm{p}}(\cdot)$ are also provided. In \cite{Kaushik15}, $f_{R_\textrm{s}}(\cdot)$ represented a pdf of the capacity. Here, we modify this expression to determine the pdf of the secondary throughput

\begin{equation}
	\label{Rspdf}
	f_{R_\textrm{s}}\left(x\right) =
	\frac{T}{T-\tau_\textrm{est}}\frac{N K \theta_\textrm{I} \alpha_\textrm{s} \ln{2}}{2 \sigma_\textrm{p}^2 \sigma_\textrm{s}^2} 
	\left(\frac{p\left(x\right)+1}{\left[p\left(x\right)\right]^2} \right)
	e^{-\frac{N}{2 \sigma_\textrm{p}^2} \left(\frac{K \theta_\textrm{I} \alpha_\textrm{s}}{p\left(x\right)\sigma_\textrm{s}^2} + \alpha_\textrm{p} P_\textrm{tran} \right)}
\end{equation}
\begin{equation*}
	\times \left(\frac{K \theta_\textrm{I} \alpha_\textrm{s}}{p\left(x\right) \alpha_\textrm{p} P_\textrm{tran}\sigma_\textrm{s}^2}\right)^{\frac{N}{4}-\frac{1}{2}}
	I_{\frac{N}{2}-1}\left(\frac{N}{\sigma_\textrm{p}^2}\sqrt{\frac{K \theta_\textrm{I} \alpha_\textrm{p} P_\textrm{tran} \alpha_\textrm{s}}{p\left(x\right) \sigma_\textrm{s}^2}}\right) \;  ,
\end{equation*}
\begin{equation*}
\text{with } p\left(x\right) = 2^\frac{Tx}{T-\tau_\textrm{est}}-1 \;  .
\end{equation*} 


The definition of $P_\textrm{c}$ can be retrieved from \cite{Kaushik15}. It is based on the cumulative distribution function (cdf) of $P_\textrm{p}$\footnote{In \cite{Kaushik15}, we discovered a small typing error in the cdf of $P_\textrm{p}$, in this paper, we present the exact version of it.}
\begin{equation}
	\label{kumu}
	F_{P_\textrm{p}}\left(x\right) = Q_{\frac{N}{2}}\left(\sqrt{\frac{N P_\textrm{tran} \alpha_\textrm{p}}{\sigma_\textrm{p}^2}},\sqrt{\frac{N \alpha_\textrm{p} \theta_\textrm{I} K}{\sigma_\textrm{p}^2 x}}\right) \;  ,
\end{equation}
with parameters defined in \cite{Kaushik15}. $Q_{\frac{N}{2}}(\cdot)$ is the Marcum Q-function \cite{Jef00}.

It is challenging to determine the parameter $\sigma_\textrm{p}^2$ utilized in most of the theoretical expressions, accurately. We decided to approximate $\sigma_\textrm{p}^2$ by setting it equal to the variance of the envelope of $y_\textrm{rcvd}$, as this provided the best fit of the model function to the measurement values.


\section{Validation}
\label{val}

\subsection{Experimental Setup}

Fig. \ref{messaufbau} illustrates the experimental setup used for validation. The primary link is implemented via a cable and attenuators. By doing so, we were able to acquire a large number of system variable realizations measured under similar conditions, which we needed for validating the stochastic model. 

The CR/ST is implemented in a Universal Software Radio Peripherals (USRP) B210 from Ettus Research \cite{Ettus}. There, upon arrival, the pilot signal is down-converted to an intermediate frequency, band-pass filtered, down-converted to baseband and decimated. The first two steps were carried out to avoid I/Q imbalance and remove the receiver's DC offset and the flicker noise (1/f) around the DC. Due to the small bandwidth of the pilot signal, these effects were the bottleneck of our validation and had to be accounted for. The decimation is performed to reduce the effect of correlation between the samples due to oversampling, since the model function $f_{P_\textrm{rcvd}}(\cdot)$ required independent and identically distributed energy samples \cite{Kaushik15}. Finally, the measurement data is analyzed offline using Matlab.

\begin{figure}
	%\vspace{-10 pt}
	\centering
	\includegraphics[width=0.8\textwidth]{figures/setup}
	\caption{Measurement setup for the validation of the stochastic model, laptop image from \cite{Laptop}}
	\label{messaufbau}
	%\vspace{-10 pt}
\end{figure}


\subsection{Validation of System Parameters}

Since the stochastic model is the basis of the further performance analysis that will be carried out over $P_\textrm{c}$ and $R_\textrm{s}$, as a first step, we validate the pdfs of the system variables $P_\textrm{rcvd}$, $P_\textrm{cont}$, $P_\textrm{p}$, and $R_\textrm{s}$, from Section \ref{model} and \cite{Kaushik15}. To this end, measurements with the setup in Fig. \ref{messaufbau} have been performed for different values of received signal-to-noise ratio at the ST over the primary link ($\snrrcvd$\footnote{As noise power, we used the measured receiver noise floor.}). The measurement data was plotted in terms of histograms and scaled such that it represented the relative frequency ($f_\textrm{rel}$). Fig. \ref{hrel_pdf} compares the histograms from the measurements and plotted pdfs using the analytical expressions for different system parameters. The plots show that the theoretical expressions very accurately capture the performance of real world cognitive radio systems.

\begin{figure}
	%\vspace{-10 pt}
	\centering
	\includegraphics[width=0.5\textwidth]{figures/40}%
	\includegraphics[width=0.5\textwidth]{figures/P_cont_40dBm_k100}%
	
	\includegraphics[width=0.5\textwidth]{figures/P_p_40dBm_k100}%
	\includegraphics[width=0.5\textwidth]{figures/R_s_40dBm_k100}%
	\caption{Theoretical expressions of the pdf and experimental results of different system variables (parameters from Table \ref{param})}
	\label{hrel_pdf}
	%\vspace{-10 pt}
\end{figure}

We repeated the experiment for different values of $\snrrcvd$. It was observed that for a considerable range of $\snrrcvd \in (4,30)\SI{}{dB}$, the theoretical expressions depicted a significant accuracy to the experimental data, refer to Table \ref{nichtzentral}. The accuracy was quantified in terms of relative error ($e_\textrm{rel}$) defined as
\begin{equation}
\label{fr}
e_\textrm{rel} = \frac{1}{n_\textrm{bins}} \times \sum_{n=1}^{n_\textrm{bins}} \frac{f_{P_\textrm{rcvd}}[n] - f_\textrm{rel}[n]}{f_\textrm{rel}[n]} \;  , 
\end{equation}
where $n_\textrm{bins}$ is the number of histogram bins with $f_\textrm{rel}[n] \neq 0$.

%\begin{table}
%	\vspace{-10 pt}
%	\setlength{\tabcolsep}{6pt} % spacing between columns
%	\centering
%	\caption{Values of the parameters used for the performing experiments.}
%	\label{param}
%	\begin{tabular}{@{}r|rrrrrrrrr@{}}
%		Parameter & $\snrrcvd$ & $N$/$\tau_\textrm{est}$ & $\theta_\textrm{I}$ & $T$ & $\alpha_\textrm{s}$ & $\sigma_\textrm{s}^2$ \\ \hline
%		Value & \SI{22}{dB} & 100/\SI{0.5}{ms} & \SI{-110}{dBm} & \SI{100]{ms} & 1 \tablefootnote{The channel gain of the ST-SR link $\alpha_\textrm{s} \in (0,1)$ was set to its maximum theoretical value for this analysis.} & $2.1355\times10^{-10}$ \tablefootnote{The value represents the measured receiver noise floor (digital value) of the in-phase or quadrature-phase components.} \\ 
%	\end{tabular}
%	%\vspace{-10 pt} 
%\end{table}

%\begin{table}
%	%\vspace{-10 pt}
%	\setlength{\tabcolsep}{3pt} % spacing between columns
%	\centering
%	\caption{$e_\textrm{rel}$ from \ref{fr} for various $\snrrcvd$ (parameters from Table \ref{param})}
%	\label{nichtzentral}
%	\begin{tabular}{@{}r|rrrrrrrrr@{}}
%		$\snrrcvd$/[dB] & $4.08$ & $9.10$ & $14.11$ &	$19.12$ & $24.09$ &	$29.09$ & $34.03$ &	$39.38$ & $45.08$ \\ \hline
%		$e_\textrm{rel}$ & $0.0568$ & $0.0601$ & $0.0522$ & $0.0437$ &	$0.0506$ & $0.0634$ & $0.1179$ & $0.0800$ & $0.1695$ \\ 
%	\end{tabular}
%	\vspace{-10 pt} 
%\end{table}


\subsection{Validation of the Estimation-Throughput Tradeoff}

Finally, we validate the performance in terms of estimation-throughput tradeoff to yield a suitable estimation time that satisfies the interference constraint on $P_\textrm{c}$ and maximizes the achievable throughput. In contrast to the theoretical analysis presented in \cite{Kaushik15}, in Fig. \ref{RspocstricheA} we provide an empirical validation to the performance of the underlay system. Clearly, this tradeoff considers that a large $\tau_\textrm{est}$ will improve the performance of the primary system by reducing the variations in $P_\textrm{p}$. This improvement is depicted in terms of an increase in $P_\textrm{c}$. On the other hand, the increase in $\tau_\textrm{est}$ reduces the achievable secondary throughput.
\begin{figure}
	%\vspace{-10 pt}
	\centering
	\includegraphics[width=0.8\textwidth]{figures/Rs_poc_striche}
	\caption{Estimation-throughput tradeoff (parameters from Table \ref{param}), $P_\textrm{c,meas}$: empirical values of $P_\textrm{c}$, $P_\textrm{c,model}$: analytical values of $P_\textrm{c}$.}
	\label{RspocstricheA}
	%\vspace{-10 pt}
\end{figure}
Fig. \ref{RspocstricheA} also includes a validation of $P_\textrm{c}$. This is achieved by comparing its empirical values with its analytical expressions for different $\tau_\textrm{est}$. In contrast to the analytical model \cite{Kaushik15}, the empirical values of $P_\textrm{c}$ were determined using a numerical integration in the region within the confidence interval $(1  \pm \mu)\times \theta_\textrm{I}$, where $\mu$ is the accuracy as defined in \cite{Kaushik15}. Hence, with this verification, we conclude that the estimation-throughput tradeoff proposed in \cite{Kaushik15} is suitable for hardware implementation.


\section{Implementation of a Demonstrator}
\label{demo}

In this section, we provide the details on the implementation of a demonstrator for the underlay system. 

\subsection{Estimation Time}
\label{esttime}
As we already verified the dependence of $P_\textrm{c}$ and $R_\textrm{s}$ on $\tau_\textrm{est}$ (refer to Fig. \ref{RspocstricheA}), it is challenging to select $\tau_\textrm{est}$ such that the system adheres to the interference constraints at the PR and still achieves the highest possible secondary throughput. To analyze this problem, we introduce a new parameter called the optimized estimation time ($\tau_\textrm{opt}$). It is the $\tau_\textrm{est}$ that maximizes the secondary throughput according to equation (11) in \cite{Kaushik15} for a certain value of $\snrrcvd$, $\mu$ and a target value of $P_\textrm{c}$ defined as $\bar{P_\textrm{c}}$. In Fig. \ref{RspocstricheA}, this optimization process is indicated graphically by the dotted lines, where, from a fixed $\bar{P_\textrm{c}} = 0.95$, we acquire $\tau_\textrm{opt} \approx \SI{0.75}{ms}$, which corresponds to $\mathbb{E}\left[R_\textrm{s}\right] \approx \SI{7.02}{bits/s/Hz}$.

However, this analysis is carried out for a fixed value of $\snrrcvd$. Under real conditions, due to channel fading, $\snrrcvd$ is not known. In this sense, it is not possible to determine $\tau_\textrm{opt}$. To resolve this issue, we propose a procedure, whereby we analyze the variations of $\tau_\textrm{opt}$ for different values of $\snrrcvd$, refer to Fig. \ref{Tausnr}, and select $\tau_\textrm{opt}$'s maximum value. By doing this, we are able to satisfy the interference constraint for all realizations of the channel. In addition, we consider different values of $\bar{P_\textrm{c}}$. It is observed that $\tau_\textrm{opt}$ increases with the decrease in $\snrrcvd$ and attains saturation below a certain $\snrrcvd$\footnote{For varying $\theta_\textrm{I}$, while the shape of the curves changed slightly, the upper limits for $\tau_\textrm{opt}$ remained constant.} 

\begin{figure}
	%\vspace{-10 pt}
	\centering
	\includegraphics[width=0.85\textwidth]{figures/tau_snr}
	\caption{$\tau_\textrm{opt}$ over $\snrrcvd$, $\theta_\textrm{I}$ = \SI{-110}{dBm}, $\mu$ = 0.05}
	\label{Tausnr}
	%\vspace{-10 pt}
\end{figure}

The explanation of this behavior is given in the following: For large values of $\snrrcvd$,$P_\textrm{cont}$ is low, hence the variations of $P_\textrm{p}$ around $\theta_\textrm{I}$ are low and consequently a lower value of $\tau_\textrm{opt}$ is needed to maintain these variations within the confidence interval. Very weak received signals, on the other hand, cannot be distinguished from noise by the USRP, due to the quantization limit of the analog-to-digital converter in the receiver chain. This is why, below a certain $\snrrcvd$, all received signals yield the same value of $\tau_\textrm{opt}$.

We use this analysis for determining the $\tau_\textrm{est}$ in the implementation of our demonstrator. Since we target $\bar{P_\textrm{c}} = 0.95$, we choose a fixed $\tau_\textrm{est}$ of \SI{24}{ms}, which is the maximum value determined from Fig. \ref{Tausnr}. By doing so, we seek to satisfy the interference constraints at the PR, at the cost of a decreased performance in $R_\textrm{s}$, particularly at higher $\snrrcvd$ ,where $\tau_\textrm{opt}$ achieves a low value.


\subsection{Simplifications}

The main objective of this paper is to demonstrate the basic principle of an underlay scenario, in view of this, we will consider the following reasonable simplifications in the proposed analytical framework:

\begin{enumerate}
	\item We do not consider the hardware implementation of the SR, that is, it is regarded virtual in the system (refer to Fig. \ref{demo_blockA}).
	\item According to the model, the path loss is determined using \cite{Kaushik15}	
	\begin{equation}
		\label{alphap}
		\alpha_\textrm{p} = \frac{\mathbb{E}\left[P_\textrm{rcvd}\right]-\sigma_\textrm{p}^2}{P_\textrm{tran}} \;  .
	\end{equation}	
	This is not possible in practical situations, where only a single realization of $P_\textrm{rcvd}$ is available. Hence, we determine the path loss based on this realization. As $\sigma_\textrm{p}^2$ is negligible compared to $P_\textrm{rcvd}$, it can be further simplified
	\begin{equation}
		\label{alphapschlange}
		\alpha_\textrm{p} = \frac{\mathbb{E}\left[P_\textrm{rcvd}\right]-\sigma_\textrm{p}^2}{P_\textrm{tran}} \approx \frac{P_\textrm{rcvd}-\sigma_\textrm{p}^2}{P_\textrm{tran}} \approx \frac{P_\textrm{rcvd}}{P_\textrm{tran}} = \widetilde\alpha_\textrm{p} \;  .
	\end{equation}
	By not averaging over multiple realizations of $P_\textrm{rcvd}$, we expect a higher variance in the resulting powers $P_\textrm{cont}$ and $P_\textrm{p}$.
	\item The model	involves a frame synchronization (in case of Time Division Duplexing) between PR and ST, which is complicated. To simplify this matter, we propose Frequency Division Duplexing between the PR and the ST: We transmit and receive the signals using two different frequencies (\SI{2.422}{GHz} and \SI{2.423}{GHz}) over two separate antennas, as illustrated in Fig. \ref{demo_blockA}. With this technique, the channel reciprocity may be compromised.	
\end{enumerate}

\begin{figure}
	%\vspace{-10 pt}
	\centering
	\includegraphics[width=0.9\textwidth]{figures/demo_block}
	\caption{Setup and block diagram of demonstrator}
	\label{demo_blockA}
	%\vspace{-10 pt}
\end{figure}

Mapping the steps described in Section \ref{scenario} onto hardware and applying the above-mentioned simplifications, we acquire the signal flow illustrated in Fig. \ref{demo_blockA}, which we have implemented in GNU Radio using the available blocks therein.


\subsection{User Interaction and Observations}

Fig. \ref{interface} shows the user interfaces of the demonstrator, providing insights to the parameters evaluated at the PR (for instance, $P_\textrm{p}$ and $P_\textrm{c}$) and the CR/ST (for instance, $P_\textrm{rcvd}$, $P_\textrm{cont}$, and $R_\textrm{s}$). We have performed hardware calibration in the demonstrator to provide physical significance to the digital values obtained from the USRPs, hence the displayed units. As the SR has not been implemented in the hardware, to incorporate the effect of $\alpha_\textrm{s}$ on the performance of the system, we employ a slider to modify its value. %$R_\textrm{s}$ is affected by changing the value of $\alpha_\textrm{s}$ or $T$. 

As expected, changing the value of $\theta_\textrm{I}$ at the CR/ST changes the measured value of $P_\textrm{p}$ at the PR to approximately the same value. This phenomenon is highlighted in Fig. \ref{interface}. At the same time, the values of $R_\textrm{s}$ and $P_\textrm{cont}$ adapt accordingly. This demonstrates that the received power estimation done at the ST by listening to the pilot based channel, thereby acquiring the channel knowledge and performing the power control, is working in accordance to the underlay principle. 

The response to the dynamic conditions can be verified by changing the distance between the PR and ST, the effect can be captured by observing the changes in $P_\textrm{rcvd}$ and other parameters depending on it. As the distance is increased beyond a certain value, the ST operates at its maximum transmit power. This event is indicated in the user interface.

\begin{figure}
	%\vspace{-10 pt}
	\centering
	\includegraphics[width=1\textwidth]{figures/interface}
	\caption{A snapshot of the performance parameters displayed in the user interfaces}
	\label{interface}
	%\vspace{-10 pt}
\end{figure}

With $\mu = 0.05$, the demonstrator does not provide the target value of 0.95 for $P_\textrm{c}$, as the variations in $P_\textrm{p}$ are higher as expected. Certainly, this issue is partly caused by the simplifications undertaken in \ref{alphapschlange}, which have to be accounted for in future implementations. Another possible reason for this observation is that we used a pilot signal produced by a signal generator in the previous analysis, which offers a higher signal quality than the one produced by a USRP in the demonstrator. Moreover, because of the separate links for sensing and transmission and the frequency separation of \SI{1}{MHz}, the channel reciprocity in our demonstrator may be compromised compared with the theoretical model. To resolve this issue, we increase the tolerance limit to $\mu = 0.20$, which leads to the desired $P_\textrm{c}$ of 0.95. On this account, we will consider the signals being transmitted by a USRP for validation, in the future. Despite this, we have been able to demonstrate the principle working of an underlay system that employs a power control mechanism at the ST to limit the excessive interference at the PR.


\section{Summary}
\label{con}

In this paper, we have analyzed the performance of an underlay system from a deployment perspective. To this end, an existing analytical framework \cite{Kaushik15} has been validated. In this regard, the validation of a stochastic model that incorporates the pdfs of the system parameters has been considered. In addition, the performance analysis in terms of estimation-throughput tradeoff has been validated. Based on this validation, it has been illustrated that the proposed framework is suitable for real world deployments. Upon the experimental analysis, a hardware demonstrator that depicts the principle working of the underlay system has been proposed. More importantly, the hardware challenges and simplifications considered while deploying the demonstrator have been briefly discussed.  

In the future, we intend to reconsider certain simplifications made while deploying the demonstrator, for instance, we propose to deploy a USRP for the SR and try to synchronize the frame structure at the ST and the PR in order to respect channel reciprocity.












%Implementation using software defined radio.
%\section{Interweave system}
%
%\subsection{System model}
%
%\subsection{Measurement setup}
%\begin{figure}[!t]
%        \centering
%        \includegraphics[trim=0.0cm 0.0cm 5.28cm 0.0cm,clip=true,width=\columnwidth]{../kapitel05/figures/Interweave_GUI.png}
%        \caption{Utilization probability for ranking the GSM subchannels.}
%        \label{fig:uti}
%\end{figure}
%Hardware demonstration \cite{Kaushik_ISWCS} of \ac{CR} that
%\begin{itemize}
%\item detects spectrum holes or temporal opportunities in \ac{PU} system 
%\item illustrates cognitive sensing ,i.e, it estimates the spectral occupancy for the multi-band \ac{PU} system
%\end{itemize}
%
%\subsection{Analysis}
%
%\section{Underlay system}
%
%\subsection{System model}
%CR models the channel coefficients $h_\text{p}$, $h_\text{s}$, using Rayleigh or Nakagami-$m$ distribution for the indoor-indoor and indoor-outdoor links. In literature, Rayleigh distribution is mostly preferred due to its analytical tractability. In contrast to that, Nakagami-$m$ accounts for the severity in fading through $m$ parameter, thus, it is more applicable in indoor scenarios. For a fixed transmit power at CR, the received signal to noise power $\gamma$\footnote{Consider a transmission from a certain CR, then $\gamma$ is equivalent to signal to noise ratio (SNR) at ID and interference to noise ratio at PR. Therefore, the term SNR is not used to avoid confusion thereof. Moreover, the interference from unintended primary transmitters and other CRs at PR or ID is treated as white noise.} at PR or ID, corresponding to Rayleigh case, follows exponential distribution \cite{simon2005}
%\begin{equation}
%\label{eq:expo}
%F_{\gamma}(\gamma) = 1 - e^{- \frac{\gamma}{\bar{\gamma}} }
%\end{equation}
%and for Nakagami-$m$, it follows Gamma distribution \cite{simon2005}
%\begin{equation}
%\label{eq:gamma}
%F_{\gamma}(\gamma) = 1 - \frac{ \Gamma{ \left( m, m \frac{\gamma}{\bar{\gamma}} \right) }}{\Gamma(m)},
%\end{equation}
%where $\bar{\gamma} = \mathbb{E}[\gamma]$ and $m$ denotes the shape parameter. $\Gamma(\cdot)$ and $\Gamma(\cdot,\cdot)$ are the complete and incomplete Gamma functions. 
%
%
%\begin{figure}[!t]
%        \centering
%        \includegraphics[width = \columnwidth]{../kapitel05/figures/wo_channels_CR_Scenario_farbig_general}
%        \caption{A scenario demonstrating the interaction between the PU and the CR. The CR senses PUs channels in the outdoor to provide a dynamic access to the devices operating indoor.}
%        \label{fig:scenario}
%\end{figure}
%
%\begin{figure}[!t]
%        \centering
%        \includegraphics[width = 0.8\columnwidth]{../kapitel05/figures/setup}
%        \caption{Hardware setup.}
%        \label{fig:hw_setup}
%\end{figure}
%
%
%\ac{CR} operating as underlay system \cite{Kaushik_CROWNCOM}
%\begin{itemize}
%\item deploys propagation models to capture movements of \ac{PR} and \ac{ID}
%\item implements sharing constraints to access the \ac{PU} channel 
%\end{itemize}
%
%\subsection{Measurement setup}
%\begin{figure}[!t]
%        \centering
%        \includegraphics[width = \columnwidth]{../kapitel05/figures/floor_B}
%        \caption{The deployment scenario for the CR including ID and PR at different spatial positions. The circle around the PR and ID positions represents $\mathbb{R}$, which illustrates their small movements.}
%        \label{fig:deploymentScenario}
%\end{figure}
%
%\begin{figure}[!t]
%        \centering
%        \includegraphics[width = 0.8\columnwidth]{../kapitel05/figures/setup}
%        \caption{Hardware setup.}
%        \label{fig:hw_setup}
%\end{figure}
%
%\subsection{Analysis}
%
%\subsubsection{\ac{IC} at PR}
%
%\begin{table}
%\renewcommand{\arraystretch}{1.3}
%\caption{Parameters and MSE of the $F_{I}$ modeled using Rayleigh and Nakagami-$m$ distribution for different PR positions}
%\label{tb:MSE_II}
%\centering
%\begin{tabular}{c||c|c}
%\hline
%\bfseries Outdoor & \bfseries Rayleigh (\ref{eq:expo}) & \bfseries Nakagami-$m$ (\ref{eq:gamma}) \\
%\bfseries Position & [MSE, $\widehat{\bar{\gamma}}]$ & [MSE, $(\widehat{m}, \widehat{\bar{\gamma}}$)] \\
%\hline\hline
%PR1 & $[3.84 \cdot 10^{-4}, 2.66 \cdot 10^{2} ]$  & $[1.74 \cdot 10^{-4} , (1.13, 2.66 \cdot 10^{2})] $ \\ \hline
%PR2 & $[2.75 \cdot 10^{-4}, 4.89 \cdot 10^{2}]$  & $[2.40 \cdot 10^{-4} , (0.98, 4.89 \cdot 10^{2})] $ \\ \hline
%PR3 & $[2.75 \cdot 10^{-4}, 57.34]$  & $[2.31 \cdot 10^{-4} , (1.11, 57.34)] $ \\ \hline
%PR4 & $[9.36 \cdot 10^{-4}, 94.20]$  & $[2.18 \cdot 10^{-4} , (1.25, 94.20)] $ \\ \hline
%\end{tabular}
%\end{table}
%
%
%\subsubsection{\ac{CC} at ID}
%
%\begin{figure}%
%\centering
%\begin{tikzpicture}[scale = 1.2]
%\node[anchor=south west,inner sep=0] (image) at (0,0)
%{\includegraphics[trim=1.5cm 0.4cm 1.45cm 1.2cm,clip=true,width=\columnwidth]{../kapitel05/figures/Interference_CDF_ana_vs_sim_indoor_outdoor}};
%\begin{scope}[x={(image.south east)},y={(image.north west)}]
%\draw  (0.832,0.99) node[above=-0.1pt, font=\small] {$I_{\text{th}}$};
%\draw  (.97,0.898) node[right=-2.2pt, font=\small] {$\epsilon_{\text{I,out}}$};
%\draw[black,thick,<->] (0.97,0.898) --  node[right=-2.2pt, font=\small] {$\epsilon_{\text{I,out}}$} (0.97,0.985);
%\draw [thick] (0.831,0.985) -- (0.831,0.096);
%\draw [thick] (0.08,0.898) -- (0.956,0.898);
%
%%Select channels for based on Interference Constraint   
%\draw (0.675,0.85) ellipse(24pt and 5pt)  node[left=28pt, font=\small] {IC};
%\draw[help lines,xstep=.1,ystep=.1] (0,0) grid (1,1);
%\foreach \x in {0,1,...,9} { \node [anchor=north] at (\x/10,0) {0.\x}; }
%\foreach \y in {0,1,...,9} { \node [anchor=east] at (0,\y/10) {0.\y}; }
%\end{scope}
%\end{tikzpicture}
%\caption{Interference distribution function at different PR positions.}
%\label{subfig:indoor-outdoor}
%\end{figure}
%
%\begin{figure}
%\centering
%\begin{tikzpicture}[scale = 1.2]
%\node[anchor=south west,inner sep=0] (image) at (0,0)
%{\includegraphics[trim=1.5cm 0.4cm 1.45cm 1.2cm,clip=true,width=\columnwidth]{../kapitel05/figures/Capacity_CDF_ana_vs_sim_indoor_indoor}};
%\begin{scope}[x={(image.south east)},y={(image.north west)}]
%\draw  (0.255,0.99) node[above=-0.1pt, font=\small] {$C_{\text{th}}$};
%\draw  (.97,0.178) node[right=-2.2pt, font=\small] {$\epsilon_{\text{C,out}}$};
%\draw[black,thick,<->] (0.97,0.095) --  node[right=-2.2pt, font=\small] {$\epsilon_{\text{C,out}}$} (0.97,0.186);
%\draw [thick] (0.255,0.985) -- (0.255,0.096);
%\draw [thick] (0.08,0.186) -- (0.956,0.186);
%Select channels for based on Capacity Constraint       
%\draw (0.48,0.58) ellipse (38pt and 5pt)  node[right=48 pt, font=\small] {CC};
%\draw[help lines,xstep=.1,ystep=.1] (0,0) grid (1,1);
%\foreach \x in {0,1,...,9} { \node [anchor=north] at (\x/10,0) {0.\x}; }
%\foreach \y in {0,1,...,9} { \node [anchor=east] at (0,\y/10) {0.\y}; }
%\end{scope}
%\end{tikzpicture}
%\label{subfig:indoor-indoor}
%\end{figure}
%
%\begin{table}
%\renewcommand{\arraystretch}{1.3}
%\caption{Parameters and MSE of the $F_{C}$ modeled using Rayleigh and Nakagami-$m$ distribution for different ID positions}
%\label{tb:MSE_IO}
%\centering
%\begin{tabular}{c||c|c}
%\hline
%\bfseries Indoor & \bfseries Rayleigh (\ref{eq:expo}) & \bfseries Nakagami-$m$ (\ref{eq:gamma}) \\
%\bfseries Position & [MSE, $\widehat{\bar{\gamma}}]$ & [MSE, $(\widehat{m}, \widehat{\bar{\gamma}}$)] \\
%\hline\hline
%ID1 & $[1.11 \cdot 10^{-3}, 9.52 \cdot 10^{2}]$  & $[1.74 \cdot 10^{-4} , (1.23, 9.52 \cdot 10^{2})] $ \\ \hline
%ID2 & $[1.60 \cdot 10^{-3}, 3.65 \cdot 10^{4}]$  & $[3.39 \cdot 10^{-4} , (1.28, 3.65 \cdot 10^{4})] $ \\ \hline
%ID3 & $[5.79 \cdot 10^{-4}, 1.79 \cdot 10^{2}]$  & $[1.35 \cdot 10^{-4} , (1.17, 1.79 \cdot 10^{2})] $ \\ \hline
%ID4 & $[9.35 \cdot 10^{-4}, 4.13 \cdot 10^{2}]$  & $[3.05 \cdot 10^{-4} , (1.16, 4.13 \cdot 10^{2})] $ \\ \hline
%ID5 & $[7.54 \cdot 10^{-4}, 6.99 \cdot 10^{4}]$  & $[2.96 \cdot 10^{-4} , (1.23, 6.99 \cdot 10^{4})] $ \\ \hline
%\end{tabular}
%\end{table}
%
%
%\begin{table}[!h]
%\renewcommand{\arraystretch}{1.3}
%\caption{Cognitive relay implementing AND rule for different PR and ID positions}
%\label{tb:BDecisions}
%\centering
%\begin{tabular}{c||c|c|c|c}
%\hline
%\bfseries & PR1 & PR2 & PR3 & PR4 \\
%\hline\hline
%ID1 & 1 $\cdot$ 0 = 0 & 0 $\cdot$ 0 = 0 & 1 $\cdot$ 0 = 0 & 1 $\cdot$ 0 = 0 \\ \hline
%ID2 & 1 $\cdot$ 1 = 1 & 0 $\cdot$ 1 = 0 & 1 $\cdot$ 1 = 1 & 1 $\cdot$ 1 = 1 \\ \hline
%ID3 & 1 $\cdot$ 1 = 1 & 0 $\cdot$ 1 = 0 & 1 $\cdot$ 1 = 1 & 1 $\cdot$ 1 = 1 \\ \hline
%ID4 & 1 $\cdot$ 0 = 0 & 0 $\cdot$ 0 = 0 & 1 $\cdot$ 0 = 0 & 1 $\cdot$ 0 = 0 \\ \hline
%ID5 & 1 $\cdot$ 1 = 1 & 0 $\cdot$ 1 = 0 & 1 $\cdot$ 1 = 1 & 1 $\cdot$ 1 = 1 \\ \hline
%\end{tabular}
%\end{table}




